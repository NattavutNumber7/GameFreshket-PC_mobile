<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Freshket: Peace of Mind Delivery</title>
    
    <meta property="og:title" content="Freshket: Peace of Mind Delivery Game">
    <meta property="og:description" content="‡πÄ‡∏Å‡∏°‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏±‡∏î‡∏™‡∏£‡∏£‡∏Ç‡∏≠‡∏á‡∏™‡∏î ‡∏™‡πà‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ö‡∏≤‡∏¢‡πÉ‡∏à‡πÉ‡∏´‡πâ‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£ ‡∏°‡∏≤‡∏î‡∏π‡∏Å‡∏±‡∏ô‡∏ß‡πà‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏â‡∏≤‡∏¢‡∏≤‡∏≠‡∏∞‡πÑ‡∏£!">
    <meta property="og:image" content="https://i.postimg.cc/gkVwzGf8/FRESHKET_LOGO-01_(1).png">
    <meta property="og:url" content="https://www.freshket.co">
    <meta property="og:type" content="website">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;700;800;900&display=swap" rel="stylesheet">
    <style>
        html, body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            position: fixed;
        }
        body {
            font-family: 'Kanit', sans-serif;
            background-color: #F3EAE3;
            touch-action: none; 
            user-select: none;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
        }
        canvas {
            display: block;
            background: linear-gradient(180deg, #008065 0%, #00CE7C 100%);
            width: 100%;
            height: 100%;
        }
        #ui-layer {
            padding-left: env(safe-area-inset-left);
            padding-right: env(safe-area-inset-right);
            padding-bottom: env(safe-area-inset-bottom);
            padding-top: env(safe-area-inset-top);
        }
        
        .glass-panel {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: all 0.2s ease;
        }
        .score-pop {
            animation: scoreImpact 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border-color: #FF6600;
        }
        @keyframes scoreImpact {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); box-shadow: 0 0 20px rgba(255, 102, 0, 0.6); color: #FF6600; }
            100% { transform: scale(1); }
        }
        .floating {
            animation: floating 3s ease-in-out infinite;
        }
        @keyframes floating {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            100% { transform: translate(-1px, -2px) rotate(-1deg); }
        }
        .shake {
            animation: shake 0.2s infinite;
        }

        #rotate-warning {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: #008065;
            z-index: 9999;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            text-align: center;
        }

        @media screen and (orientation: portrait) {
            #rotate-warning { display: flex; }
            #ui-layer, canvas { display: none !important; }
        }
    </style>
</head>
<body>

    <div id="rotate-warning">
        <div class="text-6xl mb-4">üì±‚Üª</div>
        <h2 class="text-2xl font-black uppercase">Please Rotate Your Device</h2>
        <p class="mt-2 text-sm opacity-80">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏´‡∏°‡∏∏‡∏ô‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°</p>
    </div>

    <canvas id="gameCanvas"></canvas>

    <!-- UI Layer: ‡πÉ‡∏ä‡πâ Padding ‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ p-1 -->
    <div id="ui-layer" class="absolute inset-0 pointer-events-none p-1 md:p-6 flex flex-col justify-between">
        <!-- Header: Score & Time (‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡πÄ‡∏•‡πá‡∏Å‡∏à‡∏¥‡πã‡∏ß‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠) -->
        <div class="flex justify-between items-start">
            <!-- Score Box: ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç text-sm, ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ text-[5px] -->
            <div id="scoreBox" class="glass-panel p-0.5 px-2 md:p-3 md:px-6 rounded-lg md:rounded-2xl shadow-lg">
                <p class="text-[5px] md:text-[10px] uppercase tracking-[0.1em] text-[#008065] font-bold opacity-70 text-center">Score</p>
                <div id="scoreText" class="text-sm md:text-3xl font-black text-slate-800 leading-none text-center">0</div>
            </div>
            <div class="flex flex-col items-end gap-1 md:gap-2 text-right">
                <!-- Time Box: ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç text-sm, ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ text-[5px] -->
                <div class="glass-panel p-0.5 px-2 md:p-3 md:px-6 rounded-lg md:rounded-2xl shadow-lg">
                    <p class="text-[5px] md:text-[10px] uppercase tracking-[0.1em] text-[#FF6600] font-bold opacity-70">Time</p>
                    <span id="timeText" class="text-sm md:text-3xl font-black text-slate-800 leading-none">30</span>
                </div>
                <!-- Restart Button: text-[5px] ‡πÄ‡∏•‡πá‡∏Å‡∏à‡∏¥‡πã‡∏ß -->
                <button onclick="location.reload()" class="pointer-events-auto text-[5px] md:text-[10px] bg-white/20 hover:bg-white/40 text-white px-1.5 py-0.5 md:px-3 md:py-1.5 rounded-full border border-white/30 transition-all font-bold tracking-wider">
                    RESTART ‚Üª
                </button>
            </div>
        </div>

        <!-- Start Screen -->
        <div id="start-screen" class="absolute inset-0 flex flex-col items-center justify-center bg-[#008065]/95 pointer-events-auto p-4 text-center overflow-y-auto">
            <div class="bg-white p-1.5 md:p-3 rounded-xl md:rounded-3xl mb-1.5 md:mb-3 shadow-2xl floating shrink-0">
                 <img src="https://i.postimg.cc/gkVwzGf8/FRESHKET_LOGO-01_(1).png" alt="Freshket Logo" class="h-5 md:h-12 w-auto object-contain">
            </div>
            
            <h1 class="text-sm md:text-3xl font-black text-white mb-0.5 md:mb-2 tracking-tight uppercase leading-tight shrink-0">Your Trusted Solution<br>for Food Supplies</h1>
            <p class="text-white/70 mb-2 md:mb-4 text-[7px] md:text-[11px] uppercase tracking-[0.25em] font-medium shrink-0">‡∏Ñ‡∏±‡∏î‡∏™‡∏£‡∏£‡∏Ç‡∏≠‡∏á‡∏™‡∏î ‡∏™‡πà‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ö‡∏≤‡∏¢‡πÉ‡∏à‡πÉ‡∏´‡πâ‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£</p>
            
            <!-- Cards Container -->
            <div class="flex flex-row gap-2 md:gap-3 w-full max-w-4xl mb-3 md:mb-6 items-stretch justify-center h-[140px] md:h-auto">
                
                <!-- Card 1: Rules -->
                <div class="bg-white rounded-[16px] md:rounded-[24px] p-1.5 md:p-6 shadow-2xl flex-1 border-t-2 md:border-t-8 border-[#FF6600] flex flex-col max-w-[260px] md:max-w-none">
                    <h3 class="text-[#008065] font-black text-[10px] md:text-xl mb-1 md:mb-5 uppercase tracking-widest border-b border-gray-100 pb-0.5 md:pb-2 flex items-center justify-center gap-1 md:gap-2">
                        <span>üì¶</span> ‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤
                    </h3>
                    <div class="grid grid-cols-3 gap-1 md:gap-2 flex-1">
                        <div class="bg-gray-50 p-0.5 md:p-2 rounded-md md:rounded-xl border border-gray-100 flex flex-col justify-center items-center h-full">
                            <span class="text-base md:text-3xl block mb-0 md:mb-1">ü•¨ü•©</span>
                            <p class="text-[6px] md:text-[14px] text-gray-400 font-bold uppercase mb-0">‡∏™‡∏î</p>
                            <p class="text-[#008065] font-black text-[10px] md:text-2xl">+10</p>
                        </div>
                        <div class="bg-yellow-50 p-0.5 md:p-2 rounded-md md:rounded-xl border border-yellow-100 flex flex-col justify-center items-center h-full">
                            <span class="text-base md:text-3xl block mb-0 md:mb-1">‚≠ê</span>
                            <p class="text-[6px] md:text-[14px] text-yellow-600 font-bold uppercase mb-0">‡∏¢‡∏±‡∏Å‡∏©‡πå</p>
                            <p class="text-yellow-500 font-black text-[10px] md:text-2xl">+50</p>
                        </div>
                        <div class="bg-red-50 p-0.5 md:p-2 rounded-md md:rounded-xl border border-red-100 flex flex-col justify-center items-center h-full">
                            <span class="text-base md:text-3xl block mb-0 md:mb-1">üí©üêõ</span>
                            <p class="text-[6px] md:text-[14px] text-red-400 font-bold uppercase mb-0">‡∏´‡πâ‡∏≤‡∏°</p>
                            <p class="text-red-500 font-black text-[10px] md:text-2xl">-20</p>
                        </div>
                    </div>
                </div>

                <!-- Card 2: Rank -->
                <div class="bg-white rounded-[16px] md:rounded-[24px] p-1.5 md:p-6 shadow-2xl flex-1 border-t-2 md:border-t-8 border-[#F5CE3E] flex-col hidden md:flex">
                    <h3 class="text-[#008065] font-black text-[10px] md:text-xl mb-1 md:mb-5 uppercase tracking-widest border-b border-gray-100 pb-0.5 md:pb-2 flex items-center justify-center gap-1 md:gap-2">
                        <span>üèÜ</span> ‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
                    </h3>
                    <div class="space-y-1 md:space-y-2 flex-1 text-[7px] md:text-base flex flex-col justify-center"> 
                        <div class="flex justify-between items-center bg-gray-50 p-1 md:p-2.5 px-2 md:px-4 rounded-md md:rounded-xl text-[8px] md:text-lg border border-gray-100">
                            <span class="font-bold text-gray-600">üê£ ‡∏°‡∏∑‡∏≠‡πÉ‡∏´‡∏°‡πà</span>
                            <span class="font-black text-[#008065]">0-150</span>
                        </div>
                        <div class="flex justify-between items-center bg-green-50 p-1 md:p-2.5 px-2 md:px-4 rounded-md md:rounded-xl text-[8px] md:text-lg border border-green-100">
                            <span class="font-bold text-[#008065]">ü•¶ ‡∏°‡∏∑‡∏≠‡πÇ‡∏õ‡∏£</span>
                            <span class="font-black text-[#008065]">151-350</span>
                        </div>
                        <div class="flex justify-between items-center bg-orange-50 p-1 md:p-2.5 px-2 md:px-4 rounded-md md:rounded-xl text-[8px] md:text-lg border border-orange-100">
                            <span class="font-bold text-[#FF6600]">‚ú® VIBE</span>
                            <span class="font-black text-[#FF6600]">351-550</span>
                        </div>
                        <div class="flex justify-between items-center bg-yellow-50 p-1 md:p-2.5 px-2 md:px-4 rounded-md md:rounded-xl text-[8px] md:text-lg border border-yellow-200">
                            <span class="font-bold text-yellow-700">ü•á LEGEND</span>
                            <span class="font-black text-yellow-700">551+</span>
                        </div>
                    </div>
                </div>
            </div>

            <button onclick="startGame()" class="bg-[#FF6600] hover:bg-[#e55c00] text-white text-sm md:text-xl font-black px-6 py-1.5 md:px-12 md:py-3 rounded-full shadow-[0_3px_0_rgb(180,70,0)] md:shadow-[0_6px_0_rgb(180,70,0)] active:shadow-none active:translate-y-[4px] transition-all mb-2 md:mb-4 shrink-0 tracking-wider">
                START MISSION!
            </button>
            
            <div class="flex gap-4 md:gap-8 text-white/40 text-[7px] md:text-[10px] font-bold uppercase tracking-[0.2em] shrink-0">
                <span>üì± Drag / Touch</span>
                <span>üíª Mouse / Keys</span>
            </div>
        </div>

        <!-- Game Over Screen -->
        <div id="game-over" class="absolute inset-0 flex items-center justify-center bg-black/70 backdrop-blur-md pointer-events-auto hidden">
            <div id="over-card" class="glass-panel p-4 md:p-10 rounded-[24px] md:rounded-[40px] text-center w-[90%] max-w-md shadow-2xl border-4 border-[#F5CE3E]">
                <div id="game-over-icon" class="text-3xl md:text-5xl mb-1 md:mb-4">üèÜ</div>
                <h2 id="status-title" class="text-lg md:text-2xl font-black text-[#008065] mb-0.5 md:mb-1 uppercase tracking-tight leading-tight">Your Trusted Delivery<br>Success!</h2>
                
                <div class="relative inline-block my-2 md:my-8">
                    <div class="text-5xl md:text-8xl font-black text-[#FF6600] tracking-tighter" id="finalScore">0</div>
                    <div class="absolute -top-1 md:-top-2 -right-4 md:-right-6 rotate-12 bg-[#F5CE3E] text-black text-[6px] md:text-[10px] font-black px-1.5 md:px-2 py-0.5 md:py-1 rounded">PTS</div>
                </div>

                <div class="bg-white/50 p-2 md:p-5 rounded-xl md:rounded-3xl mb-3 md:mb-8 border-2 border-dashed border-slate-300">
                    <p class="text-[7px] md:text-[10px] text-slate-500 font-bold uppercase tracking-widest mb-0.5 md:mb-1">‡∏â‡∏≤‡∏¢‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠</p>
                    <p id="rankText" class="font-black text-base md:text-xl text-[#008065] tracking-tight">‡πÄ‡∏ä‡∏ü‡∏°‡∏∑‡∏≠‡πÇ‡∏õ‡∏£!</p>
                </div>

                <button onclick="location.reload()" class="w-full bg-[#FF6600] text-white font-black py-2.5 md:py-5 rounded-lg md:rounded-2xl shadow-xl hover:bg-[#e55c00] transition-colors flex items-center justify-center gap-1.5 md:gap-2 tracking-wide">
                    <span class="text-base md:text-2xl">‚Üª</span> RESTART MISSION
                </button>
            </div>
        </div>
    </div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const scoreText = document.getElementById('scoreText');
    const timeText = document.getElementById('timeText');
    const startScreen = document.getElementById('start-screen');
    const gameOverScreen = document.getElementById('game-over');
    const overCard = document.getElementById('over-card');
    const finalScoreDisplay = document.getElementById('finalScore');
    const rankText = document.getElementById('rankText');
    const statusTitle = document.getElementById('status-title');
    const gameOverIcon = document.getElementById('game-over-icon');
    const scoreBox = document.getElementById('scoreBox');

    const logoImg = new Image();
    logoImg.src = 'https://i.postimg.cc/gkVwzGf8/FRESHKET_LOGO-01_(1).png';

    let score = 0;
    let timeLeft = 30;
    let gameActive = false;
    let items = [];
    let particles = [];
    let fireworks = [];
    let clouds = [];
    let floatingTexts = [];
    let isDragging = false; 
    
    let player = {
        x: 0,
        y: 0,
        targetX: 0, 
        lastX: 0,
        width: 120,
        height: 80,
        tilt: 0,
        speed: 16
    };

    const keys = { ArrowLeft: false, ArrowRight: false };

    function initClouds() {
        clouds = [];
        const cloudCount = 8;
        for (let i = 0; i < cloudCount; i++) {
            clouds.push({
                x: (canvas.width / cloudCount) * i + (Math.random() * 50),
                baseY: Math.random() * 40 + 70, 
                y: 0,
                w: Math.random() * 80 + 100,
                pulseOffset: Math.random() * Math.PI * 2,
                pulseSpeed: 0.005 + Math.random() * 0.005,
                opacity: Math.random() * 0.15 + 0.35
            });
        }
    }

    function drawCloud(c) {
        c.y = c.baseY + Math.sin(Date.now() * c.pulseSpeed + c.pulseOffset) * 4;
        ctx.save();
        ctx.fillStyle = `rgba(255, 255, 255, ${c.opacity})`;
        ctx.beginPath();
        ctx.arc(c.x, c.y, c.w * 0.3, 0, Math.PI * 2);
        ctx.arc(c.x + c.w * 0.25, c.y - c.w * 0.1, c.w * 0.3, 0, Math.PI * 2);
        ctx.arc(c.x + c.w * 0.5, c.y, c.w * 0.3, 0, Math.PI * 2);
        ctx.arc(c.x + c.w * 0.25, c.y + c.w * 0.1, c.w * 0.25, 0, Math.PI * 2);
        ctx.fill();
        ctx.restore();
    }

    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        player.y = canvas.height - 140; 
        if (canvas.height < 500) player.y = canvas.height - 100; 
        
        player.x = (canvas.width / 2) - (player.width / 2);
        player.targetX = player.x; 
        player.lastX = player.x;
        initClouds();
    }
    
    window.addEventListener('resize', resize);
    window.addEventListener('orientationchange', () => {
        setTimeout(resize, 200);
    });
    
    resize();

    function handleInputStart(clientX) {
        isDragging = true;
        movePlayer(clientX);
    }

    function handleInputMove(clientX) {
        if (isDragging) {
            movePlayer(clientX);
        }
    }

    function handleInputEnd() {
        isDragging = false;
    }

    canvas.addEventListener('touchstart', (e) => {
        e.preventDefault(); 
        handleInputStart(e.touches[0].clientX);
    }, { passive: false });

    canvas.addEventListener('touchmove', (e) => {
        e.preventDefault(); 
        handleInputMove(e.touches[0].clientX);
    }, { passive: false });

    canvas.addEventListener('touchend', handleInputEnd);

    canvas.addEventListener('mousedown', (e) => handleInputStart(e.clientX));
    window.addEventListener('mousemove', (e) => handleInputMove(e.clientX));
    window.addEventListener('mouseup', handleInputEnd);
    
    window.addEventListener('keydown', (e) => { if (keys.hasOwnProperty(e.code)) keys[e.code] = true; });
    window.addEventListener('keyup', (e) => { if (keys.hasOwnProperty(e.code)) keys[e.code] = false; });

    function movePlayer(clientX) {
        player.targetX = clientX - (player.width / 2);
    }

    const goodItems = ['ü•¨', 'ü•©', 'üçÖ', 'ü•¶', 'üç§', 'ü•ö', 'üåΩ'];
    const badItems = ['ü¶†', 'ü•Ä', 'üí©', 'üêõ']; 

    function createParticle(x, y, color) {
        for (let i = 0; i < 12; i++) {
            particles.push({
                x, y,
                vx: (Math.random() - 0.5) * 12,
                vy: (Math.random() - 0.5) * 12,
                life: 1,
                color: color || '#FFFFFF'
            });
        }
    }

    function createFirework() {
        const x = Math.random() * canvas.width;
        const y = Math.random() * (canvas.height * 0.6);
        const colors = ['#00CE7C', '#FF6600', '#F5CE3E', '#FFFFFF'];
        const color = colors[Math.floor(Math.random() * colors.length)];
        for (let i = 0; i < 30; i++) {
            const angle = Math.random() * Math.PI * 2;
            const speed = 2 + Math.random() * 5;
            fireworks.push({ x, y, vx: Math.cos(angle) * speed, vy: Math.sin(angle) * speed, life: 1, color });
        }
    }

    function createFloatingText(x, y, text, color) {
        floatingTexts.push({ x, y, text, color, life: 1, vy: -3 });
    }

    function spawnItem() {
        if (!gameActive) return;
        const rand = Math.random();
        let type, isGood, isBonus = false, size = 45;
        
        if (rand < 0.08) { type = goodItems[Math.floor(Math.random() * goodItems.length)]; isGood = true; isBonus = true; size = 95; }
        else if (rand < 0.82) { type = goodItems[Math.floor(Math.random() * goodItems.length)]; isGood = true; }
        else { type = badItems[Math.floor(Math.random() * badItems.length)]; isGood = false; }

        let itemSpeed;
        if (isBonus) {
             itemSpeed = 6.0; 
        } else {
             itemSpeed = 3.6 + Math.random() * 2.1; 
        }

        items.push({
            x: Math.random() * (canvas.width - size),
            y: 70,
            text: type,
            isGood,
            isBonus,
            size,
            speed: itemSpeed, 
            rotation: 0,
            rotSpeed: (Math.random() - 0.5) * 0.12
        });
        
        setTimeout(spawnItem, Math.max(180, 720 - (score * 1.6)));
    }

    function startGame() {
        startScreen.classList.add('hidden');
        gameActive = true;
        score = 0;
        timeLeft = 30;
        items = [];
        particles = [];
        fireworks = [];
        spawnItem();
        player.lastX = player.x;
        player.targetX = player.x;
        
        const timerInterval = setInterval(() => {
            if (!gameActive) { clearInterval(timerInterval); return; }
            timeLeft--;
            timeText.innerText = timeLeft;
            if (timeLeft <= 0) endGame();
        }, 1000);
        requestAnimationFrame(update);
    }

    function update() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        clouds.forEach(drawCloud);

        if (gameActive) {
            if (keys.ArrowLeft) player.targetX -= player.speed;
            if (keys.ArrowRight) player.targetX += player.speed;
            
            if (player.targetX < 0) player.targetX = 0;
            if (player.targetX > canvas.width - player.width) player.targetX = canvas.width - player.width;

            player.x += (player.targetX - player.x) * 0.2;
            player.tilt = (player.x - player.lastX) * 0.04;
            
            if (player.tilt > 0.8) player.tilt = 0.8;
            if (player.tilt < -0.8) player.tilt = -0.8;

            player.lastX = player.x;

            for (let i = items.length - 1; i >= 0; i--) {
                let item = items[i];
                item.y += item.speed;
                item.rotation += item.rotSpeed;
                ctx.save();
                ctx.translate(item.x + item.size/2, item.y + item.size/2);
                ctx.rotate(item.rotation);
                if (item.isBonus) { ctx.shadowBlur = 25; ctx.shadowColor = '#F5CE3E'; }
                ctx.font = `${item.size}px sans-serif`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(item.text, 0, 0);
                ctx.restore();

                if (item.y + item.size > player.y && item.y < player.y + player.height && item.x + item.size > player.x && item.x < player.x + player.width) {
                    if (item.isGood) {
                        let pts = item.isBonus ? 50 : 10;
                        score += pts;
                        createParticle(item.x + item.size/2, item.y + item.size/2, item.isBonus ? '#F5CE3E' : '#FFFFFF');
                        createFloatingText(item.x + item.size/2, item.y, `+${pts}`, item.isBonus ? '#F5CE3E' : '#FFFFFF');
                        scoreBox.classList.remove('score-pop');
                        void scoreBox.offsetWidth;
                        scoreBox.classList.add('score-pop');
                    } else {
                        score = Math.max(0, score - 20);
                        createParticle(item.x + item.size/2, item.y + item.size/2, '#444444');
                        createFloatingText(item.x + item.size/2, item.y, `-20`, '#FF0000');
                    }
                    scoreText.innerText = score;
                    items.splice(i, 1);
                    continue;
                }
                if (item.y > canvas.height) items.splice(i, 1);
            }

            ctx.save();
            ctx.translate(player.x + player.width/2, player.y + player.height/2);
            ctx.rotate(player.tilt);
            ctx.fillStyle = '#008065';
            roundRect(ctx, -player.width/2, -player.height/2, player.width, player.height, 18, true);
            
            ctx.filter = 'brightness(0) invert(1)';
            const logoW = player.width * 0.7;
            const logoH = logoImg.height * (logoW / logoImg.width);
            ctx.drawImage(logoImg, -logoW/2, -logoH/2, logoW, logoH);
            ctx.filter = 'none';

            ctx.restore();
        }

        for (let i = particles.length - 1; i >= 0; i--) {
            let p = particles[i];
            p.x += p.vx; p.y += p.vy; p.life -= 0.025;
            if (p.life <= 0) { particles.splice(i, 1); continue; }
            ctx.fillStyle = p.color;
            ctx.globalAlpha = p.life;
            ctx.beginPath(); ctx.arc(p.x, p.y, 4 * p.life, 0, Math.PI*2); ctx.fill();
        }

        for (let i = fireworks.length - 1; i >= 0; i--) {
            let f = fireworks[i];
            f.x += f.vx; f.y += f.vy; f.vy += 0.05; f.life -= 0.015;
            if (f.life <= 0) { fireworks.splice(i, 1); continue; }
            ctx.fillStyle = f.color;
            ctx.globalAlpha = f.life;
            ctx.beginPath(); ctx.arc(f.x, f.y, 3 * f.life, 0, Math.PI*2); ctx.fill();
        }

        for (let i = floatingTexts.length - 1; i >= 0; i--) {
            let f = floatingTexts[i];
            f.y += f.vy; f.life -= 0.02;
            if (f.life <= 0) { floatingTexts.splice(i, 1); continue; }
            ctx.fillStyle = f.color;
            ctx.globalAlpha = f.life;
            ctx.font = '800 28px Kanit';
            ctx.fillText(f.text, f.x, f.y);
        }
        ctx.globalAlpha = 1;
        requestAnimationFrame(update);
    }

    function endGame() {
        gameActive = false;
        gameOverScreen.classList.remove('hidden');
        finalScoreDisplay.innerText = score;
        let rank = "";
        if (score <= 150) {
            rank = "‡∏°‡∏∑‡∏≠‡πÉ‡∏´‡∏°‡πà‡∏´‡∏±‡∏î‡∏™‡∏±‡πà‡∏á... ‡∏™‡∏π‡πâ‡πÄ‡∏Ñ‡πâ‡∏≤‡∏ß‡∏±‡∏¢‡∏£‡∏∏‡πà‡∏ô! üê£";
            statusTitle.innerText = "OOPS! TRY HARDER";
            gameOverIcon.innerText = "ü•ó";
            overCard.classList.add('shake');
            ctx.fillStyle = 'rgba(0,0,0,0.3)';
            ctx.fillRect(0,0,canvas.width,canvas.height);
        } else if (score <= 350) {
            rank = "‡πÄ‡∏ä‡∏ü‡∏°‡∏∑‡∏≠‡πÇ‡∏õ‡∏£... ‡∏™‡πà‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ö‡∏≤‡∏¢‡πÉ‡∏à‡∏£‡∏±‡∏ß‡πÜ ü•¶";
            statusTitle.innerText = "MISSION COMPLETE!";
            gameOverIcon.innerText = "üë®‚Äçüç≥";
        } else if (score <= 550) {
            rank = "VIBE ARCHITECT! ‡∏ï‡∏±‡∏ß‡∏ï‡∏∂‡∏á Freshket ‚ú®";
            statusTitle.innerText = "FANTASTIC WORK!";
            gameOverIcon.innerText = "üëë";
            startFireworks(3);
        } else {
            rank = "LEGENDARY PARTNER! ‡∏ú‡∏π‡πâ‡∏Å‡∏≠‡∏ö‡∏Å‡∏π‡πâ‡∏Ñ‡∏£‡∏±‡∏ß‡πÑ‡∏ó‡∏¢ ü•á";
            statusTitle.innerText = "UNBELIEVABLE VIBE!";
            gameOverIcon.innerText = "üöÄ";
            startFireworks(8);
        }
        rankText.innerText = rank;
    }

    function startFireworks(count) { for(let i=0; i<count; i++) { setTimeout(createFirework, i * 400); } }

    function roundRect(ctx, x, y, width, height, radius, fill) {
        if (typeof radius === 'number') { radius = {tl: radius, tr: radius, bl: radius, br: radius}; }
        ctx.beginPath();
        ctx.moveTo(x + radius.tl, y);
        ctx.lineTo(x + width - radius.tr, y);
        ctx.quadraticCurveTo(x + width, y, x + width, y + radius.tr);
        ctx.lineTo(x + width, y + height - radius.br);
        ctx.quadraticCurveTo(x + width, y + height, x + width - radius.br, y + height);
        ctx.lineTo(x + radius.bl, y + height);
        ctx.quadraticCurveTo(x, y + height, x, y + height - radius.bl);
        ctx.lineTo(x, y + radius.tl);
        ctx.quadraticCurveTo(x, y, x + radius.tl, y);
        ctx.closePath();
        if (fill) ctx.fill();
    }
</script>
</body>
</html>
